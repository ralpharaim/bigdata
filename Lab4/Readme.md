# Lab 4 - Zookeeper 
### Используется библиотеку kazoo - аналог ZooKeeper на python.
## Решение
### Philosophers
#### Задание
Решите проблему обедающих философов (каждый философ - отдельный процесс в системе)
#### Описание
1. Каждый философ - объект класса *Philosopher*, который в себе содержит свой id, id левой и правой вилки, id левого и правого соседа, имя задачи и "путь" до вилок.
2. В методе *run* определяем замки на стол и свои вилки
3. Философы едят только *eat_seconds* с начала отсчёта
4. Берём вилки только, если они свободны и философ поел не больше, чем его соседи
5. Если вилки взяты, то кушаем, сообщаем об этом, увеличиваем счетчик количества приема пищи и ложим вилки, иначе думаем
6. Хадаём параметры и создаём процессы философов
7. Храним количество приёмов пищи в общем листе, для того чтобы он синхронизировался вызываем Manager. 
8. Создаём и "запускаем" каждого философа
#### Результат
Как видно, каждый философ почти одинаково.   
![image](https://user-images.githubusercontent.com/91950488/204774529-7b7c4d97-c5d7-4ac3-9031-aa7a9eb2862b.png)

### 2PC
#### Задание
Реализуйте двуфазный коммит протокол для high-available регистра (каждый регистр - отдельный процесс в системе)
#### Описание
1. Создаём координатор
2. Храним лист, чтобы знать заходил ли уже клиент
3. Создаём узлы
4. Попадаем в *watch_clients* по деволту без аргументов
5. Запускаем клиентов
6. Клиенты хранят путь до своего узла и свой id
7. Клиенты рандомно выбирают свой ответ и пишут об своём решении
8. Клиенты сохраняют результат на своём узле и ждут
9. Также они параллельно смотрят за изменением своего узла
10. Если они долго ждут, то останавливаются
11. Как только подключается клиент в листе проставляем True
12. Если клиент отключился, то отсылаем остальным клиентам, что надо отключиться
13. Если подъключились все клиенты, то принимаем решение.
14. Как только оно принято, рассылаем его всем на узлы, соответсвенно тригерим DataWatch у клиентов. 
#### Результат
Всё отлично  
![image](https://user-images.githubusercontent.com/91950488/204777784-58047a59-2e19-439d-b2f2-c78b4c52b76a.png)
